{% extends 'layout.html' %}
{% block body %}
  <div class="page-header">
    <h1>Add/Edit Wiki Page</h1>
  </div>

  <div class="col-md-8">
    <form name="editform" method="POST" class="form-horizontal">
      {{ form.csrf_token }}
      <div class="form-group">
        {{ form.email.label(class='control-label col-sm-2') }}
        <div class="col-sm-10">
          {{ form.email(class='form-control') }}
        </div>
      </div>
      <div class="form-group">
        {{ form.emailtitle.label(class='control-label col-sm-2') }}
        <div class="col-sm-10">
          {{ form.emailtitle(class='form-control') }}
          <div id="content_editor"></div>
        </div>
      </div>

      <div class="form-group">
        {{ form.content.label(class='control-label col-sm-2') }}
        <div class="col-sm-10">
          {{ form.content(class='form-control', id='content_textarea') }}
          <div id="content_editor"></div>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="submit" class="btn btn-primary">Add/Edit Page</button>
          <a href="{{ url_for('wiki.home') }}" class="btn btn-default">Cancel</a>
        </div>
      </div>
    </form>

    <script src="{{ url_for('static', filename='js/ace/ace.js') }}" charset="utf-8"></script>
    <script src="{{ url_for('static', filename='js/ace/mode-markdown.js') }}" charset="utf-8"></script>
    <script>
    var editor = ace.edit('content_editor');
    var textarea = $('textarea[id=content_textarea]').hide();
    var MarkdownMode = ace.require("ace/mode/markdown").Mode;
    editor.$blockScrolling = Infinity;
    editor.getSession().setValue(textarea.val());
    editor.session.setMode(new MarkdownMode());
    editor.getSession().on('change', function(){
      textarea.val(editor.getSession().getValue());
    });
    </script>
{% endblock %}
