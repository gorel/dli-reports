{% extends 'layout.html' %}
{% block body %}
  <div class="page-header">
    <h1>Report: {{report.name }}</h1>
  </div>

  <h2>Data for {{ ds }}</h2>

  <p>
  Switch to data for <u><b><a href="{{ url_for('reports.submit_report_data', report_id=report.id, ds='yesterday') }}">Yesterday</a></b></u> or <u><b><a href="{{ url_for('reports.submit_report_data', report_id=report.id) }}">Today</a></b></u>
  </p>

  <div class="col-md-3">
    <form id="form" method="POST" action="" url_for('reports.view_report') }} class="form-horizontal">
      {{ form.csrf_token }}
      {{ form.date(class='form-control normal datepicker', type='text', placeholder='Or click here to choose a date') }}
    </form>
  </div>

  <div class="pull-right">
    <p>Tags: {{ report.tagnames|join(', ') }}</p>
    <a href="{{ url_for('reports.download_report', report_id=report.id) }}" class="btn btn-info">Download as Excel</a>
  </div>

  {% for department in dept_data %}
    <table class="table table-striped">
      <thead>
        <tr>
          <th>{{ department }}</th>
        </tr>
      </thead>

      <tbody>
        {% for field in dept_data[department] %}
          <tr>
            <td>{{ field['name'] }}</td>
            <td>{{ field['value'] }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endfor %}

  <script>
    $('#date').datepicker({
      format: "yyyy-mm-dd",
      maxDate: "+0d"
    }).change(function(ev) {
      $('#form').submit();
    }).on('changeDate', function(ev) {
      $('#form').submit();
    });
  </script>
{% endblock %}
