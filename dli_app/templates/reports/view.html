{% extends 'layout.html' %}
{% block body %}
  <div class="page-header">
    <h1>Report: {{report.name }} <small>Data for {{ ds }}</small></h1>
  </div>

  <div class="col-md-4">
    <form method="POST">
      {{ form.csrf_token }}
        <span class="input-group">
          <span class="input-group-addon">
            View data for
          </span>
          {{ form.date(class='form-control normal datepicker', type='text', value=ds, placeholder='Select a date') }}
          <span class="input-group-btn">
            <button type="submit" class="btn btn-primary">Update</button>
          </span>
        </span>
      </p>
    </form>

    <div class="form-actions">
      <a href="{{ url_for('reports.download_report', report_id=report.id) }}" class="btn btn-info">Download as Excel</a>
    </div>

    <div class="tags">
      <span class="tag-head">Tagged with:</span>
      {% for tag in report.tagnames %}
        <span class="tag">{{ tag }}</span>
      {% endfor %}
    </div>
  </div>

  <div class="col-md-8">
    {% for department in dept_data %}
      <table class="table table-striped">
        <thead>
          <tr>
            <th>{{ department }}</th>
          </tr>
        </thead>

        <tbody>
          {% for field in dept_data[department] %}
            <tr>
              <td>{{ field['name'] }}</td>
              <td>{{ field['value'] }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endfor %}
  </div>

  <script>
    $('#date').datepicker({
      format: "yyyy-mm-dd",
      maxDate: "+0d",
      endDate: "+0d"
    }).change(function(ev) {
      $('#form').submit();
    }).on('changeDate', function(ev) {
      $('#form').submit();
    });
  </script>
{% endblock %}
